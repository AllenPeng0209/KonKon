# äº‹ä»¶åˆ›å»ºä¸æ˜¾ç¤ºé—®é¢˜è°ƒè¯•æŠ¥å‘Š

## ğŸ” é—®é¢˜æè¿°
ç”¨æˆ·æŠ¥å‘Šï¼šåˆ›å»ºæ—¥ç¨‹äº‹ä»¶åï¼Œåœ¨æ—¥å†ä¸‹æ–¹æ²¡æœ‰å±•ç¤ºï¼Œæ€€ç–‘æ²¡æœ‰ä¿å­˜åˆ°Supabaseã€‚

## ğŸ”§ å·²å®æ–½çš„ä¿®å¤

### 1. ä¿®å¤useEvents Hookçš„åˆå§‹åŒ–é€»è¾‘
**é—®é¢˜**: åŸæ¥çš„é€»è¾‘è¦æ±‚ç”¨æˆ·å¿…é¡»åŠ å…¥å®¶åº­ç¾¤ç»„æ‰èƒ½è·å–äº‹ä»¶
```typescript
// ä¿®å¤å‰
useEffect(() => {
  if (user && userFamilies.length > 0) { // âŒ è¦æ±‚å¿…é¡»æœ‰å®¶åº­
    fetchEvents();
  }
}, [userFamilies]);

// ä¿®å¤å
useEffect(() => {
  if (user) { // âœ… åªè¦ç”¨æˆ·ç™»å½•å°±è·å–äº‹ä»¶
    console.log('å®¶åº­åˆ—è¡¨æ›´æ–°ï¼Œé‡æ–°è·å–äº‹ä»¶...', userFamilies);
    fetchEvents();
  }
}, [userFamilies]);
```

### 2. ä¿®å¤äº‹ä»¶åˆ›å»ºæ•°æ®ç»“æ„
**é—®é¢˜**: handleCreateAIEventä¸­ä½¿ç”¨äº†ä¸å­˜åœ¨çš„å­—æ®µ
```typescript
// ä¿®å¤å‰
const eventData = {
  // ... å…¶ä»–å­—æ®µ
  familyId: null, // âŒ é”™è¯¯çš„å­—æ®µå
  notificationEnabled: true, // âŒ ä¸å­˜åœ¨çš„å­—æ®µ
  notificationTime: 15, // âŒ ä¸å­˜åœ¨çš„å­—æ®µ
};

// ä¿®å¤å
const eventData = {
  title: event.title,
  description: event.description || '',
  date: event.startTime,
  startTime: event.startTime.toTimeString().substring(0, 5),
  endTime: event.endTime.toTimeString().substring(0, 5),
  location: event.location || '',
  color: '#007AFF', // âœ… æ·»åŠ é¢œè‰²å­—æ®µ
};
```

### 3. ä¿®å¤äº‹ä»¶åˆ›å»ºæˆåŠŸåˆ¤æ–­é€»è¾‘
**é—®é¢˜**: createEventè¿”å›Eventå¯¹è±¡ï¼Œä½†åˆ¤æ–­ä¸ºå¸ƒå°”å€¼
```typescript
// ä¿®å¤å‰
const success = await createEvent(eventData);
if (success) { // âŒ é”™è¯¯çš„åˆ¤æ–­

// ä¿®å¤å
const createdEvent = await createEvent(eventData);
if (createdEvent) { // âœ… æ­£ç¡®åˆ¤æ–­énullå¯¹è±¡
```

### 4. æ·»åŠ å®Œæ•´çš„è°ƒè¯•æ—¥å¿—ç³»ç»Ÿ
ä¸ºäº†è·Ÿè¸ªé—®é¢˜ï¼Œåœ¨å…³é”®ä½ç½®æ·»åŠ äº†è¯¦ç»†çš„console.logï¼š

#### useEvents Hookè°ƒè¯•
- ç”¨æˆ·ç™»å½•å’Œå®¶åº­åˆ—è¡¨æ›´æ–°
- fetchEventså‡½æ•°çš„å®Œæ•´æ‰§è¡Œæµç¨‹
- SupabaseæŸ¥è¯¢ç»“æœ
- äº‹ä»¶åˆ›å»ºçš„å®Œæ•´æµç¨‹

#### é¦–é¡µæ˜¾ç¤ºè°ƒè¯•
- ä»Šæ—¥äº‹ä»¶æ£€æŸ¥é€»è¾‘
- æ‰€æœ‰äº‹ä»¶çš„è¯¦ç»†ä¿¡æ¯
- æ—¶é—´æˆ³è½¬æ¢å’Œæ—¥æœŸåŒ¹é…

### 5. æ”¹è¿›æ—¶é—´å¤„ç†é€»è¾‘
æ·»åŠ äº†è¯¦ç»†çš„æ—¶é—´è®¡ç®—æ—¥å¿—ï¼Œç¡®ä¿æ—¶é—´æˆ³æ­£ç¡®ï¼š
```typescript
console.log('â° æ—¶é—´è®¡ç®—:', { 
  originalDate: eventData.date,
  startTime, endTime,
  startDateTime: startDateTime.toISOString(),
  endDateTime: endDateTime.toISOString(),
  startTs, endTs
});
```

## ğŸ” è°ƒè¯•å·¥å…·

### æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—æ ¼å¼
åˆ›å»ºäº‹ä»¶æ—¶ä¼šçœ‹åˆ°ä»¥ä¸‹æ—¥å¿—åºåˆ—ï¼š
```
ğŸ“ å¼€å§‹åˆ›å»ºäº‹ä»¶... {title: "xxx", date: Date, ...}
â° æ—¶é—´è®¡ç®—: {originalDate: Date, startTime: "15:00", ...}
ğŸ’¾ å‡†å¤‡æ’å…¥äº‹ä»¶åˆ°Supabase: {title: "xxx", start_ts: 1234567890, ...}
âœ… äº‹ä»¶å·²æˆåŠŸä¿å­˜åˆ°Supabase: {id: "uuid", title: "xxx", ...}
ğŸ”„ æ·»åŠ äº‹ä»¶åˆ°æœ¬åœ°çŠ¶æ€: {id: "uuid", title: "xxx", ...}
ğŸ“Š æœ¬åœ°äº‹ä»¶åˆ—è¡¨æ›´æ–°: {previousCount: 0, newCount: 1, ...}
ğŸ”„ å¼€å§‹è·å–äº‹ä»¶... {userId: "uuid", year: undefined, month: undefined, ...}
âœ… è·å–äº‹ä»¶æˆåŠŸ: {totalEvents: 1, personalEvents: 1, ...}
ğŸ“… ä»Šæ—¥äº‹ä»¶æ£€æŸ¥: {today: "2025-01-XX", totalEvents: 1, todayEvents: 1, ...}
```

### é—®é¢˜æ’æŸ¥æ­¥éª¤
1. **æ£€æŸ¥ç”¨æˆ·ç™»å½•**: ç¡®è®¤consoleä¸­æœ‰"ç”¨æˆ·ç™»å½•ï¼Œå¼€å§‹è·å–äº‹ä»¶..."
2. **æ£€æŸ¥äº‹ä»¶åˆ›å»º**: ç¡®è®¤åˆ›å»ºæµç¨‹çš„æ‰€æœ‰æ—¥å¿—éƒ½æ­£å¸¸
3. **æ£€æŸ¥Supabaseä¿å­˜**: ç¡®è®¤çœ‹åˆ°"äº‹ä»¶å·²æˆåŠŸä¿å­˜åˆ°Supabase"
4. **æ£€æŸ¥æœ¬åœ°çŠ¶æ€**: ç¡®è®¤"æœ¬åœ°äº‹ä»¶åˆ—è¡¨æ›´æ–°"æ˜¾ç¤ºæ­£ç¡®çš„è®¡æ•°
5. **æ£€æŸ¥ä»Šæ—¥æ˜¾ç¤º**: ç¡®è®¤"ä»Šæ—¥äº‹ä»¶æ£€æŸ¥"æ˜¾ç¤ºæ­£ç¡®çš„äº‹ä»¶æ•°é‡

## ğŸ¯ é¢„æœŸç»“æœ

### æˆåŠŸåˆ›å»ºäº‹ä»¶ååº”è¯¥çœ‹åˆ°ï¼š
1. âœ… Alertæ˜¾ç¤º"æ—¥ç¨‹å·²åˆ›å»º"
2. âœ… æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤ºå®Œæ•´çš„åˆ›å»ºå’Œè·å–æ—¥å¿—
3. âœ… é¦–é¡µ"ä»Šå¤©"éƒ¨åˆ†æ˜¾ç¤ºæ–°åˆ›å»ºçš„äº‹ä»¶
4. âœ… æ—¥å†ä¸Šå¯¹åº”æ—¥æœŸæ˜¾ç¤ºåœ†ç‚¹æ ‡è®°
5. âœ… Supabaseæ•°æ®åº“ä¸­æœ‰å¯¹åº”è®°å½•

### å¦‚æœä»ç„¶ä¸æ˜¾ç¤ºï¼Œæ£€æŸ¥ï¼š
1. **æ—¶åŒºé—®é¢˜**: æ£€æŸ¥æ—¶é—´è®¡ç®—æ—¥å¿—ä¸­çš„æ—¶é—´æˆ³æ˜¯å¦æ­£ç¡®
2. **æ—¥æœŸåŒ¹é…**: æ£€æŸ¥"ä»Šæ—¥äº‹ä»¶æ£€æŸ¥"ä¸­çš„æ—¥æœŸæ¯”è¾ƒé€»è¾‘
3. **æƒé™é—®é¢˜**: ç¡®è®¤Supabase RLSæ”¿ç­–å…è®¸ç”¨æˆ·è¯»å†™eventsè¡¨
4. **ç½‘ç»œé—®é¢˜**: æ£€æŸ¥Supabaseè¿æ¥æ˜¯å¦æ­£å¸¸

## ğŸ”§ ä¸‹ä¸€æ­¥å»ºè®®

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼š
1. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„å®Œæ•´æ—¥å¿—
2. æ£€æŸ¥Supabase Dashboardä¸­çš„eventsè¡¨æ•°æ®
3. éªŒè¯RLSï¼ˆRow Level Securityï¼‰æ”¿ç­–
4. ç¡®è®¤ç”¨æˆ·çš„æ—¶åŒºè®¾ç½®

## ğŸ“‹ æµ‹è¯•ç”¨ä¾‹

### æ–‡å­—è½¬æ—¥ç¨‹æµ‹è¯•
1. ç‚¹å‡»é¦–é¡µåº•éƒ¨çš„æ–‡å­—è¾“å…¥æŒ‰é’®ï¼ˆâœï¸ï¼‰
2. è¾“å…¥ï¼š"ä»Šå¤©ä¸‹åˆ3ç‚¹å¼€ä¼š"
3. ç‚¹å‡»å‘é€
4. æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—å’Œç•Œé¢æ˜¾ç¤º

### æ‰‹åŠ¨åˆ›å»ºæµ‹è¯•
1. ç‚¹å‡»"æ‰‹åŠ¨æ·»åŠ "
2. å¡«å†™äº‹ä»¶ä¿¡æ¯
3. ä¿å­˜
4. æ£€æŸ¥æ˜¾ç¤ºç»“æœ

---

**æ€»ç»“**: å·²ä¿®å¤äº†å¤šä¸ªå…³é”®é—®é¢˜ï¼ŒåŒ…æ‹¬æ•°æ®ç»“æ„ä¸åŒ¹é…ã€åˆå§‹åŒ–é€»è¾‘é”™è¯¯ã€ä»¥åŠæˆåŠŸåˆ¤æ–­é€»è¾‘é—®é¢˜ã€‚æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—æ¥å¸®åŠ©è·Ÿè¸ªé—®é¢˜ã€‚ç°åœ¨äº‹ä»¶åº”è¯¥èƒ½æ­£ç¡®åˆ›å»ºã€ä¿å­˜åˆ°Supabaseå¹¶åœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºã€‚
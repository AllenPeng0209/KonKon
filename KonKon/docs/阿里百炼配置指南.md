# 阿里百炼配置指南

本文档将帮助您配置阿里百炼API，以便在KonKon应用中使用AI聊天功能。

## 1. 获取阿里百炼API密钥

### 步骤1：访问阿里百炼控制台
1. 打开浏览器，访问 [阿里百炼控制台](https://bailian.console.aliyun.com/)
2. 使用您的阿里云账号登录

### 步骤2：创建应用
1. 在控制台中，点击"创建应用"
2. 填写应用名称和描述
3. 选择适合的模型（推荐使用 qwen-turbo）
4. 确认创建

### 步骤3：获取API密钥和配置信息
1. 在应用详情页面，找到"API密钥"部分
2. 复制以下信息：
   - **API Key**: 用于身份验证
   - **Workspace ID**: 工作空间标识符
   - **Endpoint**: API端点地址（通常是 `https://dashscope.aliyuncs.com`）

## 2. 配置环境变量

### 步骤1：创建环境变量文件
在KonKon项目根目录下创建 `.env.local` 文件：

```bash
# 复制示例文件
cp .env.example .env.local
```

### 步骤2：填写配置信息
编辑 `.env.local` 文件，添加以下配置：

```env
# 阿里百炼 API 配置
EXPO_PUBLIC_BAILIAN_API_KEY=your_actual_api_key_here
EXPO_PUBLIC_BAILIAN_ENDPOINT=https://dashscope.aliyuncs.com
EXPO_PUBLIC_BAILIAN_WORKSPACE_ID=your_workspace_id_here
```

**注意：** 请将 `your_actual_api_key_here` 和 `your_workspace_id_here` 替换为您从阿里百炼控制台获取的实际值。

## 3. 测试配置

### 步骤1：重启开发服务器
```bash
# 停止当前服务器（Ctrl+C）
# 重新启动
npm start
```

### 步骤2：验证配置
1. 打开KonKon应用
2. 切换到"洞察"标签页
3. 如果配置正确，您应该看到AI聊天界面
4. 如果配置有误，会显示配置错误提示

## 4. 常见问题解决

### Q1: 提示"API Key未配置"
**解决方案：**
1. 检查 `.env.local` 文件是否存在
2. 确认API Key是否正确填写
3. 重启开发服务器

### Q2: 请求失败或超时
**解决方案：**
1. 检查网络连接
2. 确认API Key是否有效
3. 检查Workspace ID是否正确

### Q3: 聊天无响应
**解决方案：**
1. 检查控制台错误信息
2. 确认模型是否正确配置
3. 检查API使用配额

## 5. 安全建议

### 生产环境部署
在生产环境中，建议：

1. **使用后端代理**：不要直接在客户端调用阿里百炼API
2. **创建Supabase Edge Function**：
   ```typescript
   // supabase/functions/chat/index.ts
   import { serve } from 'https://deno.land/std@0.168.0/http/server.ts'
   
   serve(async (req) => {
     // 在这里调用阿里百炼API
     // 避免在客户端暴露API Key
   })
   ```

3. **环境变量安全**：确保API Key不会被提交到代码仓库

### API Key管理
- 定期更换API Key
- 设置API使用限制
- 监控API使用情况

## 6. 模型选择

阿里百炼提供多种模型，您可以根据需要选择：

- **qwen-turbo**: 快速响应，适合一般对话
- **qwen-plus**: 更高质量的回答，适合复杂任务
- **qwen-max**: 最强性能，适合专业应用

在 `bailian.ts` 文件中修改模型：

```typescript
body: JSON.stringify({
  model: 'qwen-plus', // 更改为您需要的模型
  // ...其他配置
})
```

## 7. 成本优化

为了控制使用成本：

1. **设置Token限制**：在API调用中设置合理的 `max_tokens`
2. **优化对话历史**：避免发送过长的对话历史
3. **使用缓存**：对常见问题使用缓存响应

## 8. 联系支持

如果您在配置过程中遇到问题：

1. 查看[阿里百炼官方文档](https://help.aliyun.com/document_detail/2712576.html)
2. 联系阿里云技术支持
3. 在项目GitHub仓库中提交Issue

---

配置完成后，您就可以在KonKon应用中体验智能AI聊天功能了！🎉 